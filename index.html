<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Aloha">
    <title>Aloha Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; background: #0f172a; color: white; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script>
        class App {
            constructor() {
                this.yourHcp = 8;
                this.oppHcp = 8;
                this.fatigueFactor = 0;
                this.moneyAmount = 0;
                this.mentalToughness = 5;
                this.expandedSection = 'results';
            }

            calculateOdds() {
                const hcpDiff = Math.abs(this.yourHcp - this.oppHcp);
                let tieProb = 35;
                let yourWinProb = 32.5;
                let oppWinProb = 32.5;
                
                if (hcpDiff > 0) {
                    const skillEdge = hcpDiff * 2;
                    tieProb = Math.max(20, 35 - (hcpDiff * 1.5));
                    if (this.yourHcp < this.oppHcp) {
                        yourWinProb = 32.5 + (skillEdge / 2);
                        oppWinProb = 32.5 - (skillEdge / 2);
                    } else {
                        yourWinProb = 32.5 - (skillEdge / 2);
                        oppWinProb = 32.5 + (skillEdge / 2);
                    }
                }
                
                const totalWinProb = yourWinProb + oppWinProb;
                yourWinProb = (yourWinProb / totalWinProb) * (100 - tieProb);
                oppWinProb = (oppWinProb / totalWinProb) * (100 - tieProb);
                
                let moneylineOdds = 0;
                if (Math.abs(yourWinProb - 50) < 0.1) {
                    moneylineOdds = 100;
                } else if (yourWinProb > 50) {
                    moneylineOdds = -Math.round((yourWinProb / (100 - yourWinProb)) * 100);
                } else {
                    moneylineOdds = Math.round(((100 - yourWinProb) / yourWinProb) * 100);
                }
                
                return { moneylineOdds, yourWinProb: Math.round(yourWinProb), tieProb: Math.round(tieProb) };
            }

            applyAdjustments(baseOdds) {
                let adjustedWinProb = baseOdds.yourWinProb;
                let adjustedTieProb = baseOdds.tieProb;

                if (this.fatigueFactor > 0) {
                    adjustedWinProb -= this.fatigueFactor * 1.5;
                } else if (this.fatigueFactor < 0) {
                    adjustedWinProb += Math.abs(this.fatigueFactor) * 1.5;
                }

                if (this.moneyAmount > 0) {
                    const moneyMap = [0, 1, 10, 50, 100, 250, 500, 1000];
                    const actualMoney = moneyMap[this.moneyAmount];
                    const pressureEffect = actualMoney * 0.02;
                    if (baseOdds.yourWinProb > 50) {
                        adjustedWinProb -= pressureEffect;
                    } else if (baseOdds.yourWinProb < 50) {
                        adjustedWinProb += pressureEffect * 0.3;
                    }
                    adjustedTieProb -= actualMoney * 0.003;
                }

                const mentalEdge = (this.mentalToughness - 5) * 1.2;
                adjustedWinProb += mentalEdge;

                adjustedWinProb = Math.max(5, Math.min(95, adjustedWinProb));
                adjustedTieProb = Math.max(8, adjustedTieProb);
                
                if (adjustedWinProb + adjustedTieProb > 100) {
                    adjustedTieProb = 100 - adjustedWinProb - 5;
                }

                const lossProb = 100 - adjustedWinProb - adjustedTieProb;
                let finalOdds = 0;
                if (Math.abs(adjustedWinProb - lossProb) < 0.1) {
                    finalOdds = 100;
                } else if (adjustedWinProb > lossProb) {
                    finalOdds = -Math.round((adjustedWinProb / lossProb) * 100);
                } else {
                    finalOdds = Math.round((lossProb / adjustedWinProb) * 100);
                }

                return { odds: finalOdds, winProb: Math.round(adjustedWinProb), tieProb: Math.round(adjustedTieProb), lossProb };
            }

            getMoneyDisplay() {
                const moneyMap = [0, 1, 10, 50, 100, 250, 500, 1000];
                const amount = moneyMap[this.moneyAmount];
                return amount === 0 ? '$0' : `$${amount}`;
            }

            getHandicapLabel(hcp) {
                if (hcp === 0) return 'Pro';
                if (hcp <= 5) return 'Elite';
                if (hcp <= 10) return 'Very Good';
                if (hcp <= 15) return 'Good';
                return 'Rec';
            }

            render() {
                const baseOdds = this.calculateOdds();
                const adjusted = this.applyAdjustments(baseOdds);

                const html = `
                    <div class="bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950 min-h-screen text-white pb-20">
                        <div class="h-4"></div>
                        
                        <div class="px-4 pt-2 pb-6">
                            <h1 class="text-3xl font-black tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-400 mb-1">18TH HOLE</h1>
                            <p class="text-slate-400 text-sm">Odds & Outcome</p>
                        </div>

                        <div class="px-4 mb-4">
                            <div class="bg-gradient-to-br from-green-900/30 to-emerald-900/20 border border-green-500/40 rounded-2xl p-5 shadow-2xl">
                                <p class="text-xs text-slate-400 uppercase tracking-widest font-semibold mb-4">Your Odds</p>
                                
                                <div class="grid grid-cols-3 gap-2 mb-6">
                                    <div class="bg-green-950/60 border border-green-500/50 rounded-lg p-3 text-center">
                                        <p class="text-xs text-slate-400 mb-2">Win</p>
                                        <p class="text-2xl font-black text-green-400">${adjusted.winProb}%</p>
                                    </div>
                                    <div class="bg-slate-700/40 border border-slate-500/50 rounded-lg p-3 text-center">
                                        <p class="text-xs text-slate-400 mb-2">Tie</p>
                                        <p class="text-2xl font-black text-slate-300">${adjusted.tieProb}%</p>
                                    </div>
                                    <div class="bg-red-950/60 border border-red-500/50 rounded-lg p-3 text-center">
                                        <p class="text-xs text-slate-400 mb-2">Lose</p>
                                        <p class="text-2xl font-black text-red-400">${adjusted.lossProb}%</p>
                                    </div>
                                </div>

                                <div class="bg-slate-800/50 rounded-lg p-4 text-center border border-slate-700/30">
                                    <p class="text-xs text-slate-500 mb-2">Moneyline</p>
                                    <p class="text-4xl font-black font-mono tracking-tighter ${adjusted.odds < 0 ? 'text-green-400' : adjusted.odds > 0 ? 'text-red-400' : 'text-slate-300'}">${adjusted.odds < 0 ? '' : '+'}${adjusted.odds}</p>
                                </div>
                            </div>
                        </div>

                        <div class="px-4 mb-4">
                            <div class="bg-slate-800/40 border border-slate-700/50 rounded-2xl p-5">
                                <p class="text-xs text-slate-400 uppercase tracking-widest font-semibold mb-4">Players</p>
                                
                                <div class="mb-5">
                                    <div class="flex justify-between items-center mb-3">
                                        <div>
                                            <p class="text-sm font-semibold text-slate-200">You</p>
                                            <p class="text-xs text-slate-500">${this.getHandicapLabel(this.yourHcp)}</p>
                                        </div>
                                        <p class="text-3xl font-black text-green-400">${this.yourHcp}</p>
                                    </div>
                                    <input type="range" min="0" max="20" value="${this.yourHcp}" id="yourHcp" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-green-500">
                                </div>

                                <div>
                                    <div class="flex justify-between items-center mb-3">
                                        <div>
                                            <p class="text-sm font-semibold text-slate-200">Opponent</p>
                                            <p class="text-xs text-slate-500">${this.getHandicapLabel(this.oppHcp)}</p>
                                        </div>
                                        <p class="text-3xl font-black text-red-400">${this.oppHcp}</p>
                                    </div>
                                    <input type="range" min="0" max="20" value="${this.oppHcp}" id="oppHcp" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-red-500">
                                </div>
                            </div>
                        </div>

                        <div class="px-4 mb-4">
                            <button id="factorsBtn" class="w-full bg-slate-800/40 border border-slate-700/50 rounded-2xl p-5 text-left hover:bg-slate-800/60 transition-colors">
                                <div class="flex justify-between items-center">
                                    <p class="text-xs text-slate-400 uppercase tracking-widest font-semibold">Pressure Factors</p>
                                    <span class="inline-block transition-transform" id="factorsChevron">▼</span>
                                </div>
                            </button>

                            ${this.expandedSection === 'factors' ? `
                            <div class="bg-slate-800/40 border-l border-r border-b border-slate-700/50 rounded-b-2xl p-5 space-y-5">
                                <div>
                                    <div class="flex justify-between items-center mb-3">
                                        <p class="text-sm font-semibold text-slate-200">Fatigue</p>
                                        <p class="text-lg font-bold ${this.fatigueFactor > 0 ? 'text-red-400' : this.fatigueFactor < 0 ? 'text-green-400' : 'text-slate-400'}">${this.fatigueFactor > 0 ? '+' : ''}${this.fatigueFactor}</p>
                                    </div>
                                    <input type="range" min="-5" max="5" value="${this.fatigueFactor}" id="fatigue" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-orange-500">
                                    <p class="text-xs text-slate-500 mt-2 text-center">Fresh ← → Exhausted</p>
                                </div>

                                <div>
                                    <div class="flex justify-between items-center mb-3">
                                        <p class="text-sm font-semibold text-slate-200">Money on Line</p>
                                        <p class="text-lg font-bold text-cyan-400">${this.getMoneyDisplay()}</p>
                                    </div>
                                    <input type="range" min="0" max="7" value="${this.moneyAmount}" id="money" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500">
                                </div>

                                <div>
                                    <div class="flex justify-between items-center mb-3">
                                        <p class="text-sm font-semibold text-slate-200">Mental Toughness</p>
                                        <p class="text-lg font-bold text-purple-400">${this.mentalToughness}/10</p>
                                    </div>
                                    <input type="range" min="1" max="10" value="${this.mentalToughness}" id="mental" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500">
                                </div>
                            </div>
                            ` : ''}
                        </div>

                        <div class="h-20"></div>
                    </div>
                `;

                document.getElementById('root').innerHTML = html;

                document.getElementById('yourHcp').addEventListener('input', (e) => {
                    this.yourHcp = Number(e.target.value);
                    this.render();
                });

                document.getElementById('oppHcp').addEventListener('input', (e) => {
                    this.oppHcp = Number(e.target.value);
                    this.render();
                });

                document.getElementById('fatigue').addEventListener('input', (e) => {
                    this.fatigueFactor = Number(e.target.value);
                    this.render();
                });

                document.getElementById('money').addEventListener('input', (e) => {
                    this.moneyAmount = Number(e.target.value);
                    this.render();
                });

                document.getElementById('mental').addEventListener('input', (e) => {
                    this.mentalToughness = Number(e.target.value);
                    this.render();
                });

                document.getElementById('factorsBtn').addEventListener('click', () => {
                    this.expandedSection = this.expandedSection === 'factors' ? null : 'factors';
                    this.render();
                });
            }
        }

        const app = new App();
        app.render();
    </script>
</body>
</html>